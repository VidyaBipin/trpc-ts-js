---
id: migrate-from-v9-to-v10
title: Migrate from v9 to v10
sidebar_label: Migrate from v9 to v10
slug: /migrate-from-v9-to-v10
---

import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

Nearly all of the concepts from tRPC v9 will carry over to tRPC v10. Most of the changes for v10 are syntax based.

Under the hood, we are unlocking performance improvements, bringing you quality of life enhancements, and creating room for us to build new features in the future.

tRPC v10 features a compatibility layer for users coming from v9. `.interop()` allows you to incrementally adopt v10 so that you can continue building the rest of your project while still enjoying v10's new features.

:::caution
There are [a few features that are not supported by `.interop()`](#limitations-of-interop). We expect nearly all of our users to be able to use `.interop()` to migrate their server side code in only a few minutes. If you are discovering that `.interop()` is not working correctly for you, be sure to [check here](#limitations-of-interop).
:::caution

## Enabling `interop()` on a v9 router

Turning your v9 router into a v10 router only takes 10 characters. Add `.interop()` to the end of your v9 router...and you're done with your server code!

```ts title="/server.ts"
import * as trpc from '@trpc/server';

const appRouter = trpc.router().interop();

export type AppRouter = typeof appRouter;
```

You will now need to [visit your client code to update your callers to the v10 syntax](#client-package-changes).

## Merging a v9 router into a v10 router

You may also choose to start writing new procedures using the v10 syntax - but keep your v9 procedures in place for now. Incremental adoption is only a matter of merging the two routers together.

To merge a v9 router into a v10 router, you'll need to keep the `.interop()` method on your v9 router and write a little glue code using the `.mergeRouters()` method introduced in v10.

We will create a simple `hello world` v10 router to demonstrate interoperability mode. If you have not learned how to create a more complex tRPC v10 router yet, we encourage you to check out the rest of the documentation.

```ts title="/server.ts"
import { initTRPC } from '@trpc/server';
import { legacyRouter } from './legacyRouter.ts';

export const t = initTRPC()();

const v10Router = t.router({
  greeting: t.procedure
    .input(z.string())
    .query(({ input }) => `hello ${input}!`),
});

export const appRouter = t.mergeRouters(v10Router, legacyRouter);
```

:::tip
Be careful of using procedures that will end up having the same caller name! You will run into issues if a path in your legacy router matches a path in your new router.
:::tip

Both sets of procedures will now be available for your client. You will now need to [visit your client code to update your callers to the v10 syntax](#client-package-changes).

## Limitations of `.interop()`

### Subscriptions

ðŸš§

### Custom [Links](/docs/links)

ðŸš§

## Client Package Changes

v10 also brings changes to the client side of your application. After making a few key changes, you'll unlock a few key quality of life changes:

- Jump to server definitions straight from your client
- TODO
- TODO

### `@trpc/react`

#### Upgrade of `react-query`

We've upgraded `peerDependencies` from `react-query@^3` to `@tanstack/react-query@^4`. Because our client hooks are only a thin wrapper around `react-query`, we encourage you to [visit their migration guide](https://tanstack.com/query/v4/docs/guides/migrating-to-react-query-4) for more details around our React hooks implementation.

#### tRPC-specific options on hooks moved to `trpc` property

To avoid collisions and confusion with any built-in `react-query` properties, we have moved all of the tRPC options to a property called `trpc`. This namespace brings clarity to options that are tRPC specific and ensures that we won't collide with `react-query` in the future.

```tsx
// Before
useQuery(['post.byId', '1'], {
  context: {
    batching: false,
  },
});

// After:
useQuery(['post.byId', '1'], {
  trpc: {
    context: {
      batching: false,
    },
  },
});
```

### `@trpc/next`

#### `setupNext()` - Optional DX Improvement

Setting up tRPC for Next.js is now much easier. `@trpc/next` now includes a `setupTRPC` export that scaffolds trpc in your Next.js application with sensible defaults including built-in server-side rendering.

```ts title="utils/trpc.ts"
import { setupTRPC } from '@trpc/next';
import type { AppRouter } from 'routers/_app';

export const trpc = setupTRPC<AppRouter>({
  config() {
    return {
      url: '/api/trpc',
    };
  },
});
```

```tsx title="pages/_app.tsx"
import { trpc } from '../utils/trpc';

const MyApp = ({ Component, pageProps }) => {
  return <Component {...pageProps} />;
};

export default trpc.withTRPC(MyApp);
```

We no longer have to setup the `react-query` hooks and tRPC context provider separately.

In v9, we set up the tPRC provider in `_app.tsx` and the React-Query hooks in `utils/trpc.ts` separately. In v10, we define the `trpc` object once and it will contain all you need for your Next.js application.

### `@trpc/client`

#### Aborting procedures

[The `AbortController` Web API](https://developer.mozilla.org/en-US/docs/Web/API/AbortController) allows clients to cancel their web requests using the `.abort()` method.

Previously, we had a `.cancel()` method that was a part of the tRPC implementation. We have deprecated this method in favor of `AbortController` and its `.abort()` method.

```tsx
const ac = new AbortController();
const helloQuery = client.greeting.query('posts', { signal: ac.signal });

// Aborting
ac.abort();
```
